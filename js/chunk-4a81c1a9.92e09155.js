(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a81c1a9"],{"4ea1":function(e,t,a){"use strict";var i=a("a655"),r=a.n(i);r.a},"98b7":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add"},[a("van-nav-bar",{attrs:{"left-arrow":"","right-text":"发布"},on:{"click-left":e.onClickLeft,"click-right":e.onClickRight}}),a("section",{staticClass:"main"},[a("div",{staticClass:"message-box"},[a("van-cell-group",{attrs:{border:!1}},[a("van-field",{attrs:{type:"textarea",placeholder:"分享这一刻"},model:{value:e.message,callback:function(t){e.message="string"===typeof t?t.trim():t},expression:"message"}})],1)],1),a("div",{staticClass:"uploader-box"},["image"==e.type?a("van-uploader",{attrs:{"after-read":e.afterRead,"before-read":e.beforeRead},on:{delete:e.handledelete},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}}):e._e(),a("van-divider"),e.read_file_url?a("div",{staticClass:"video-box flex align-items-center",class:{video_1:1==e.video_heng_shu,video_2:0==e.video_heng_shu}},[a("video",{attrs:{src:e.read_file_url,poster:e.video_cover,"x5-video-player-type":"h5","x5-video-orientation":"landscape|portrait",controls:"controls"}}),a("div",{staticClass:"remove-box",on:{click:function(t){return e.handleVideo()}}},[a("van-icon",{attrs:{name:"cross"}})],1)]):e._e(),"video"!=e.type||e.read_file_url?e._e():a("van-uploader",{attrs:{"after-read":e.afterRead,"before-read":e.beforeRead,accept:"video/*"},on:{delete:e.handledelete}}),a("van-divider")],1)])],1)},r=[],n=(a("b0f7"),a("bdf4"),a("7fae"),a("384e"),a("6076"),a("63ff"),a("f8f9")),s=(a("d383"),a("98e6")),o={data:function(){return{type:this.$route.query.type,video_heng_shu:"",read_file_url:"",video_cover:"",message:"",typeid:0,fileList:[],address:"",aid_list:[],longitude:"",latitude:"",attachment:"video"==this.$route.query.type?1:2}},created:function(){},methods:{getParameter:function(){return this.message||this.fileList.length||"image"!=this.type||Object(s["a"])("发布内容不能为空"),this.message||this.read_file_url||"video"!=this.type||Object(s["a"])("发布内容不能为空"),{token:this.$store.state.userData,message:this.message,typeid:this.typeid,attachment:this.attachment,address:this.address,latitude:this.latitude,longitude:this.longitude,aid_list:this.aid_list.join(",")}},addSquare:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s["a"].loading({message:"加载中...",forbidClick:!0}),e.next=3,this.postImg();case 3:t=this.getParameter(),this.api.addSquare(t).then((function(e){s["a"].clear(),0==e.err_code?a.$router.go(-1):Object(s["a"])(e.err_msg)}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleVideo:function(){this.read_file_url="",this.aid_list=[]},handledelete:function(e){},postVideo:function(e){var t=this;return new Promise((function(a,i){s["a"].loading({message:"加载中...",forbidClick:!0});var r=new FormData;r.append("token",t.$store.state.userData),r.append("myfile",e),t.api.addVideo(r).then((function(e){if(s["a"].clear(),0==e.err_code){var a=e.data,i=a.read_file_url,r=a.video_cover,n=a.video_heng_shu;t.aid_list.push(e.data.aid),t.read_file_url=i,t.video_cover=r,t.video_heng_shu=n}})).catch((function(e){Object(s["a"])(e)}))}))},postImg:function(){var e=this;return new Promise((function(t,a){var i=e.fileList.map((function(t){var a=new FormData;return a.append("token",e.$store.state.userData),a.append("myfile",t.file),a.append("type","forum"),e.api.addImage(a).then((function(t){0==t.err_code&&e.aid_list.push(t.data.aid)}))}));Promise.all(i).then((function(){t()})).catch((function(e){}))}))},afterRead:function(e){this.postVideo(e.file)},beforeRead:function(e){switch(this.type){case"image":if(9==this.fileList.length)return Object(s["a"])("只能上传9长图片"),!1;break;case"video":break}return!0},onClickLeft:function(){this.$router.go(-1)},onClickRight:function(){this.addSquare()}}},d=o,c=(a("4ea1"),a("6691")),l=Object(c["a"])(d,i,r,!1,null,"7fe5d656",null);t["default"]=l.exports},a655:function(e,t,a){}}]);
//# sourceMappingURL=chunk-4a81c1a9.92e09155.js.map