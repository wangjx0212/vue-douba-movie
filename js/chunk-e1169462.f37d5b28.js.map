{"version":3,"sources":["webpack:///./src/components/square/add.vue?f5e2","webpack:///src/components/square/add.vue","webpack:///./src/components/square/add.vue?3e24","webpack:///./src/components/square/add.vue","webpack:///./src/components/square/add.vue?9b48","webpack:///./src/assets/images/icon_play.png"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","onClickLeft","onClickRight","model","value","callback","$$v","message","trim","expression","type","afterRead","beforeRead","handledelete","fileList","_e","class","video_heng_shu","$event","handlePlay","ref","read_file_url","video_cover","handleVideo","staticRenderFns","setTimeout","component","module","exports"],"mappings":"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","file":"js/chunk-e1169462.f37d5b28.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"add\"},[_c('van-nav-bar',{attrs:{\"right-text\":\"发布\"},on:{\"click-left\":_vm.onClickLeft,\"click-right\":_vm.onClickRight}}),_c('section',{staticClass:\"main\"},[_c('div',{staticClass:\"message-box\"},[_c('van-cell-group',{attrs:{\"border\":false}},[_c('van-field',{attrs:{\"type\":\"textarea\",\"placeholder\":\"分享这一刻\"},model:{value:(_vm.message),callback:function ($$v) {_vm.message=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"message\"}})],1)],1),_c('div',{staticClass:\"uploader-box\"},[(_vm.type == 'image')?_c('van-uploader',{attrs:{\"after-read\":_vm.afterRead,\"before-read\":_vm.beforeRead},on:{\"delete\":_vm.handledelete},model:{value:(_vm.fileList),callback:function ($$v) {_vm.fileList=$$v},expression:\"fileList\"}}):_vm._e(),_c('van-divider'),(_vm.read_file_url)?_c('div',{staticClass:\"video-box flex align-items-center\",class:{'video_1':_vm.video_heng_shu == 1,'video_2':_vm.video_heng_shu == 0}},[_c('div',{staticClass:\"vide-box-content\",on:{\"click\":function($event){return _vm.handlePlay('video')}}},[_c('video',{ref:\"video\",attrs:{\"src\":_vm.read_file_url,\"preload\":\"auto\",\"poster\":_vm.video_cover}}),_c('img',{staticClass:\"icon-play\",attrs:{\"src\":require(\"../../assets/images/icon_play.png\")}})]),_c('div',{staticClass:\"remove-box\",on:{\"click\":function($event){return _vm.handleVideo()}}},[_c('van-icon',{attrs:{\"name\":\"cross\"}})],1)]):_vm._e(),(_vm.type == 'video' && !_vm.read_file_url)?_c('van-uploader',{attrs:{\"after-read\":_vm.afterRead,\"before-read\":_vm.beforeRead,\"accept\":\"video/*\"},on:{\"delete\":_vm.handledelete}}):_vm._e(),_c('van-divider')],1)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div class=\"add\">\n        <van-nav-bar            \n           \n            right-text=\"发布\"\n            @click-left=\"onClickLeft\"\n            @click-right=\"onClickRight\"\n        >   \n        </van-nav-bar>\n        <section class=\"main\">\n            <div class=\"message-box\">\n                <van-cell-group :border=\"false\">\n                    <van-field type=\"textarea\"  v-model.trim=\"message\" placeholder=\"分享这一刻\" />\n                </van-cell-group>\n            </div>\n            <div class=\"uploader-box\">\n                <van-uploader v-model=\"fileList\"  @delete=\"handledelete\"  :after-read=\"afterRead\" :before-read=\"beforeRead\" v-if=\"type == 'image'\"  />\n                <van-divider />\n                <div class=\"video-box flex align-items-center\" v-bind:class=\"{'video_1':video_heng_shu == 1,'video_2':video_heng_shu == 0}\" v-if=\"read_file_url\">\n                    <div class=\"vide-box-content\"  @click=\"handlePlay('video')\">\n                        <video ref=\"video\" :src=\"read_file_url\" preload=\"auto\"  :poster=\"video_cover\"  ></video>\n                        <img class=\"icon-play\" src=\"../../assets/images/icon_play.png\" >\n                    </div>\n                    \n                    <div class=\"remove-box\" @click=\"handleVideo()\" >\n                        <van-icon name=\"cross\" />\n                    </div>\n                </div>\n                <van-uploader @delete=\"handledelete\"  :after-read=\"afterRead\" :before-read=\"beforeRead\" accept=\"video/*\" v-if=\"type == 'video' && !read_file_url\"   />\n                <van-divider />\n            </div>\n            \n\n        </section>\n    </div>\n</template>\n\n<script>\n\nimport {getTodayDate} from '@js/moment'\n\nimport { Toast } from 'vant'\nexport default {\n    data() {\n        return {\n            type:this.$route.query.type,\n            video_heng_shu:'', // 横竖屏\n            read_file_url:'', // 视频链接\n            video_cover:'', // 视频封面图\n            message:'',\n            typeid:0,\n            fileList:[],\n            address:'',\n            aid_list:[],\n            longitude:'',\n            latitude:'',\n            attachment:this.$route.query.type == 'video' ? 1 : 2\n\n        }\n    },\n    created(){\n     console.log(this.$route.query.type);\n    },\n    methods:{\n        // 获取发帖参数\n        getParameter(){\n            if(!this.message && !this.fileList.length && this.type == 'image') {\n                Toast('发布内容不能为空');\n            }\n            if(!this.message && !this.read_file_url && this.type == 'video') {\n                Toast('发布内容不能为空');\n            }\n            return {\n                token:this.$store.state.userData,\n                message:this.message,\n                typeid:this.typeid,\n                attachment:this.attachment,\n                address:this.address,\n                latitude:this.latitude,\n                longitude:this.longitude,\n                aid_list:this.aid_list.join(',')\n            }\n        },\n        // 视频播放\n        handlePlay(ref){\n            let obj = this.$refs[ref];\n        \n            obj.play();\n            obj.webkitRequestFullScreen();\n            obj.addEventListener('pause',()=>{\n                obj.controls = false;\n        \n            })\n        },        \n        // 发贴\n        async addSquare(){\n            Toast.loading({\n                message: '加载中...',\n                forbidClick: true\n            });\n            await this.postImg();\n            let data = this.getParameter();\n            this.api.addSquare(data).then(res => {\n                Toast.clear();\n                if(res.err_code == 0){\n                    Toast('发布成功');\n                    setTimeout(() => {\n                        let json ={method:'e_loadPage()'}\n                        console.log(`teldapp://closeWebview?params=`+JSON.stringify(json));\n                        window.location.href= `teldapp://closeWebview?params=`+JSON.stringify(json)\n                    },900)\n                    //this.$router.go(-1)\n\n                }else {\n                    Toast(res.err_msg);\n                }\n              \n            }).catch(function(reason){\n            \n                });\n        },\n        // 删除视频\n        handleVideo(){\n            this.read_file_url = \"\";\n            this.aid_list = [];\n        },\n        handledelete(v){\n           \n        },\n        // 上传视频\n        postVideo(file){\n            return new Promise((resolve,reject) => {\n                Toast.loading({\n                    message: '加载中...',\n                    forbidClick: true\n                });\n                let formData = new FormData();\n                formData.append('token',this.$store.state.userData)\n                formData.append('myfile',file)\n                this.api.addVideo(formData).then(res => {\n                    Toast.clear();\n                    if(res.err_code == 0){\n                        let {read_file_url,video_cover,video_heng_shu} = res.data;\n                        this.aid_list.push(res.data.aid);\n                        this.read_file_url = read_file_url\n                        this.video_cover = video_cover\n                        this.video_heng_shu = video_heng_shu\n                    \n                    }else {\n                        Toast(res.err_msg)\n                    }\n                }).catch(err => {\n                    Toast(err)\n                })\n            })\n            \n        },\n        // 上传图片\n        postImg() {\n            return new Promise((resolve,reject)=>{\n                const promises = this.fileList.map(v =>{\n                        let formData = new FormData();\n                        formData.append('token',this.$store.state.userData)\n                        formData.append('myfile',v.file)\n                        formData.append('type','forum')\n\n                    return this.api.addImage(formData).then(res => {\n                            if(res.err_code == 0){\n                                this.aid_list.push(res.data.aid)\n                            }else {\n                            \n                            }\n                        })\n                })\n                Promise.all(promises).then(function () {\n                    resolve()\n                }).catch(function(reason){\n            \n                });\n            })\n        },\n        afterRead(file){\n            if(this.type == 'video'){\n                this.postVideo(file.file);\n            }\n           \n        },    \n        // 上传前\n        beforeRead(file) {\n            switch(this.type){\n                case 'image':\n                    if(this.fileList.length == 9){\n                        Toast('只能上传9长图片');\n                        return false\n                    }  \n                    // if (file.type !== 'image/jpeg') {\n                    //     Toast('请上传 jpg 格式图片');\n                    //     return false;\n                    // }\n                break;\n                case 'video':\n                break\n            }\n\n        \n        \n        return true;\n        },\n        // 导航左键\n        onClickLeft(){\n            this.$router.go(-1)\n        },\n        // 导航右键\n        onClickRight(){\n            this.addSquare();\n        }\n    }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.main{\n    padding-top: 24px;\n    .message-box{\n        margin-bottom: 54px;\n    }\n    .uploader-box{\n        padding: 0 15px;\n        .video-box{\n            width: 183px;\n            height: 240px;\n            margin-bottom: 5px;\n            position: relative;\n            .vide-box-content{\n                position: relative;\n                height: inherit;\n                video{\n                    width: 100%;\n                    height: 100%;\n                }\n                .icon-play{\n                    position: absolute;\n                    left: 50%;\n                    top: 50%;\n                    width: 50px;\n                    height: 50px;\n                    transform: translate(-50%,-50%)                \n                }\n            }\n\n        }\n        .remove-box{\n            width: 80px;\n            height: 80px;\n            box-sizing: border-box;\n            background-color: #fff;\n            border-radius: 2px;\n            border: 1px dashed #e5e5e5;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            margin-left: 5px;\n            flex: none;\n            i{\n                color: #969799;\n            }\n        }\n        .video_1{\n            width: 183px;\n            height: 240px;\n        }\n        .video_2{\n            width: 230px;\n            height: 160px;\n        }  \n    }\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./add.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./add.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./add.vue?vue&type=template&id=51045fd7&scoped=true&\"\nimport script from \"./add.vue?vue&type=script&lang=js&\"\nexport * from \"./add.vue?vue&type=script&lang=js&\"\nimport style0 from \"./add.vue?vue&type=style&index=0&id=51045fd7&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"51045fd7\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./add.vue?vue&type=style&index=0&id=51045fd7&lang=less&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./add.vue?vue&type=style&index=0&id=51045fd7&lang=less&scoped=true&\"","module.exports = __webpack_public_path__ + \"img/icon_play.3cd1ac49.png\";"],"sourceRoot":""}