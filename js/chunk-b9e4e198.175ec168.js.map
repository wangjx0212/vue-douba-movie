{"version":3,"sources":["webpack:///./src/components/square/add.vue?9891","webpack:///./src/components/square/add.vue?97bd","webpack:///src/components/square/add.vue","webpack:///./src/components/square/add.vue?3e24","webpack:///./src/components/square/add.vue","webpack:///./src/assets/images/icon_play.png"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","onClickLeft","onClickRight","model","value","callback","$$v","message","trim","expression","type","afterRead","beforeRead","handledelete","fileList","_e","class","video_heng_shu","$event","handlePlay","ref","read_file_url","video_cover","handleVideo","staticRenderFns","setTimeout","component","module","exports"],"mappings":"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","file":"js/chunk-b9e4e198.175ec168.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./add.vue?vue&type=style&index=0&id=16c16e5c&lang=less&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./add.vue?vue&type=style&index=0&id=16c16e5c&lang=less&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"add\"},[_c('van-nav-bar',{attrs:{\"right-text\":\"发布\"},on:{\"click-left\":_vm.onClickLeft,\"click-right\":_vm.onClickRight}}),_c('section',{staticClass:\"main\"},[_c('div',{staticClass:\"message-box\"},[_c('van-cell-group',{attrs:{\"border\":false}},[_c('van-field',{attrs:{\"type\":\"textarea\",\"placeholder\":\"分享这一刻\"},model:{value:(_vm.message),callback:function ($$v) {_vm.message=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"message\"}})],1)],1),_c('div',{staticClass:\"uploader-box\"},[(_vm.type == 'image')?_c('van-uploader',{attrs:{\"after-read\":_vm.afterRead,\"before-read\":_vm.beforeRead},on:{\"delete\":_vm.handledelete},model:{value:(_vm.fileList),callback:function ($$v) {_vm.fileList=$$v},expression:\"fileList\"}}):_vm._e(),_c('van-divider'),(_vm.read_file_url)?_c('div',{staticClass:\"video-box flex align-items-center\",class:{'video_1':_vm.video_heng_shu == 1,'video_2':_vm.video_heng_shu == 0}},[_c('div',{staticClass:\"vide-box-content\",on:{\"click\":function($event){return _vm.handlePlay('video')}}},[_c('video',{ref:\"video\",attrs:{\"src\":_vm.read_file_url,\"preload\":\"auto\",\"poster\":_vm.video_cover}}),_c('img',{staticClass:\"icon-play\",attrs:{\"src\":require(\"../../assets/images/icon_play.png\")}})]),_c('div',{staticClass:\"remove-box\",on:{\"click\":function($event){return _vm.handleVideo()}}},[_c('van-icon',{attrs:{\"name\":\"cross\"}})],1)]):_vm._e(),(_vm.type == 'video' && !_vm.read_file_url)?_c('van-uploader',{attrs:{\"after-read\":_vm.afterRead,\"before-read\":_vm.beforeRead,\"accept\":\"video/*\"},on:{\"delete\":_vm.handledelete}}):_vm._e(),_c('van-divider')],1)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"add\">\r\n        <van-nav-bar            \r\n           \r\n            right-text=\"发布\"\r\n            @click-left=\"onClickLeft\"\r\n            @click-right=\"onClickRight\"\r\n        >   \r\n        </van-nav-bar>\r\n        <section class=\"main\">\r\n            <div class=\"message-box\">\r\n                <van-cell-group :border=\"false\">\r\n                    <van-field type=\"textarea\"  v-model.trim=\"message\" placeholder=\"分享这一刻\" />\r\n                </van-cell-group>\r\n            </div>\r\n            <div class=\"uploader-box\">\r\n                <van-uploader v-model=\"fileList\"  @delete=\"handledelete\"  :after-read=\"afterRead\" :before-read=\"beforeRead\" v-if=\"type == 'image'\"  />\r\n                <van-divider />\r\n                <div class=\"video-box flex align-items-center\" v-bind:class=\"{'video_1':video_heng_shu == 1,'video_2':video_heng_shu == 0}\" v-if=\"read_file_url\">\r\n                    <div class=\"vide-box-content\"  @click=\"handlePlay('video')\">\r\n                        <video ref=\"video\" :src=\"read_file_url\" preload=\"auto\"  :poster=\"video_cover\"  ></video>\r\n                        <img class=\"icon-play\" src=\"../../assets/images/icon_play.png\" >\r\n                    </div>\r\n                    \r\n                    <div class=\"remove-box\" @click=\"handleVideo()\" >\r\n                        <van-icon name=\"cross\" />\r\n                    </div>\r\n                </div>\r\n                <van-uploader @delete=\"handledelete\"  :after-read=\"afterRead\" :before-read=\"beforeRead\" accept=\"video/*\" v-if=\"type == 'video' && !read_file_url\"   />\r\n                <van-divider />\r\n            </div>\r\n            \r\n\r\n        </section>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport {getTodayDate} from '@js/moment'\r\n\r\nimport { Toast } from 'vant'\r\nexport default {\r\n    data() {\r\n        return {\r\n            type:this.$route.query.type,\r\n            video_heng_shu:'', // 横竖屏\r\n            read_file_url:'', // 视频链接\r\n            video_cover:'', // 视频封面图\r\n            message:'',\r\n            typeid:0,\r\n            fileList:[],\r\n            address:'',\r\n            aid_list:[],\r\n            longitude:'',\r\n            latitude:'',\r\n            attachment:this.$route.query.type == 'video' ? 1 : 2\r\n\r\n        }\r\n    },\r\n    created(){\r\n     console.log(this.$route.query.type);\r\n    },\r\n    methods:{\r\n        // 获取发帖参数\r\n        getParameter(){\r\n            if(!this.message && !this.fileList.length && this.type == 'image') {\r\n                Toast('发布内容不能为空');\r\n            }\r\n            if(!this.message && !this.read_file_url && this.type == 'video') {\r\n                Toast('发布内容不能为空');\r\n            }\r\n            return {\r\n                token:this.$store.state.userData,\r\n                message:this.message,\r\n                typeid:this.typeid,\r\n                attachment:this.attachment,\r\n                address:this.address,\r\n                latitude:this.latitude,\r\n                longitude:this.longitude,\r\n                aid_list:this.aid_list.join(',')\r\n            }\r\n        },\r\n        // 视频播放\r\n        handlePlay(ref){\r\n            let obj = this.$refs[ref];\r\n        \r\n            obj.play();\r\n            obj.webkitRequestFullScreen();\r\n            obj.addEventListener('pause',()=>{\r\n                obj.controls = false;\r\n        \r\n            })\r\n        },        \r\n        // 发贴\r\n        async addSquare(){\r\n            Toast.loading({\r\n                message: '加载中...',\r\n                forbidClick: true\r\n            });\r\n            await this.postImg();\r\n            let data = this.getParameter();\r\n            this.api.addSquare(data).then(res => {\r\n                Toast.clear();\r\n                if(res.err_code == 0){\r\n                    Toast('发布成功');\r\n                    setTimeout(() => {\r\n                        let json ={method:'e_loadPage()'}\r\n                        console.log(`teldapp://closeWebview?params=`+JSON.stringify(json));\r\n                        window.location.href= `teldapp://closeWebview?params=`+JSON.stringify(json)\r\n                    },900)\r\n                    //this.$router.go(-1)\r\n\r\n                }else {\r\n                    Toast(res.err_msg);\r\n                }\r\n              \r\n            }).catch(function(reason){\r\n            \r\n                });\r\n        },\r\n        // 删除视频\r\n        handleVideo(){\r\n            this.read_file_url = \"\";\r\n            this.aid_list = [];\r\n        },\r\n        handledelete(v){\r\n           \r\n        },\r\n        // 上传视频\r\n        postVideo(file){\r\n            return new Promise((resolve,reject) => {\r\n                Toast.loading({\r\n                    message: '加载中...',\r\n                    forbidClick: true\r\n                });\r\n                let formData = new FormData();\r\n                formData.append('token',this.$store.state.userData)\r\n                formData.append('myfile',file)\r\n                this.api.addVideo(formData).then(res => {\r\n                    Toast.clear();\r\n                    if(res.err_code == 0){\r\n                        let {read_file_url,video_cover,video_heng_shu} = res.data;\r\n                        this.aid_list.push(res.data.aid);\r\n                        this.read_file_url = read_file_url\r\n                        this.video_cover = video_cover\r\n                        this.video_heng_shu = video_heng_shu\r\n                    \r\n                    }else {\r\n                        Toast(res.err_msg)\r\n                    }\r\n                }).catch(err => {\r\n                    Toast(err)\r\n                })\r\n            })\r\n            \r\n        },\r\n        // 上传图片\r\n        postImg() {\r\n            return new Promise((resolve,reject)=>{\r\n                const promises = this.fileList.map(v =>{\r\n                        let formData = new FormData();\r\n                        formData.append('token',this.$store.state.userData)\r\n                        formData.append('myfile',v.file)\r\n                        formData.append('type','forum')\r\n\r\n                    return this.api.addImage(formData).then(res => {\r\n                            if(res.err_code == 0){\r\n                                this.aid_list.push(res.data.aid)\r\n                            }else {\r\n                            \r\n                            }\r\n                        })\r\n                })\r\n                Promise.all(promises).then(function () {\r\n                    resolve()\r\n                }).catch(function(reason){\r\n            \r\n                });\r\n            })\r\n        },\r\n        afterRead(file){\r\n            if(this.type == 'video'){\r\n                this.postVideo(file.file);\r\n            }\r\n           \r\n        },    \r\n        // 上传前\r\n        beforeRead(file) {\r\n            switch(this.type){\r\n                case 'image':\r\n                    if(this.fileList.length == 9){\r\n                        Toast('只能上传9长图片');\r\n                        return false\r\n                    }  \r\n                    // if (file.type !== 'image/jpeg') {\r\n                    //     Toast('请上传 jpg 格式图片');\r\n                    //     return false;\r\n                    // }\r\n                break;\r\n                case 'video':\r\n                break\r\n            }\r\n\r\n        \r\n        \r\n        return true;\r\n        },\r\n        // 导航左键\r\n        onClickLeft(){\r\n            this.$router.go(-1)\r\n        },\r\n        // 导航右键\r\n        onClickRight(){\r\n            this.addSquare();\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.main{\r\n    padding-top: 24px;\r\n    .message-box{\r\n        margin-bottom: 54px;\r\n    }\r\n    .uploader-box{\r\n        padding: 0 15px;\r\n        .video-box{\r\n            width: 183px;\r\n            height: 240px;\r\n            margin-bottom: 5px;\r\n            position: relative;\r\n            .vide-box-content{\r\n                position: relative;\r\n                height: inherit;\r\n                video{\r\n                    width: 100%;\r\n                    height: 100%;\r\n                }\r\n                .icon-play{\r\n                    position: absolute;\r\n                    left: 50%;\r\n                    top: 50%;\r\n                    width: 50px;\r\n                    height: 50px;\r\n                    transform: translate(-50%,-50%)                \r\n                }\r\n            }\r\n\r\n        }\r\n        .remove-box{\r\n            width: 80px;\r\n            height: 80px;\r\n            box-sizing: border-box;\r\n            background-color: #fff;\r\n            border-radius: 2px;\r\n            border: 1px dashed #e5e5e5;\r\n            display: flex;\r\n            justify-content: center;\r\n            align-items: center;\r\n            margin-left: 5px;\r\n            flex: none;\r\n            i{\r\n                color: #969799;\r\n            }\r\n        }\r\n        .video_1{\r\n            width: 183px;\r\n            height: 240px;\r\n        }\r\n        .video_2{\r\n            width: 230px;\r\n            height: 160px;\r\n        }  \r\n    }\r\n}\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./add.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./add.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./add.vue?vue&type=template&id=16c16e5c&scoped=true&\"\nimport script from \"./add.vue?vue&type=script&lang=js&\"\nexport * from \"./add.vue?vue&type=script&lang=js&\"\nimport style0 from \"./add.vue?vue&type=style&index=0&id=16c16e5c&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"16c16e5c\",\n  null\n  \n)\n\nexport default component.exports","module.exports = __webpack_public_path__ + \"img/icon_play.3cd1ac49.png\";"],"sourceRoot":""}